
<html>
<head>
  <title>Shared Storage - Direct Download</title>

  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f6fa;
      margin: 0;
      padding: 0 20px;
      color: #333;
    }

    h2, h3 {
      color: #2f3640;
    }

    .upload-section {
      background: #ffffff;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      max-width: 500px;
      margin: 20px auto;
    }

    input[type="file"] {
      width: 100%;
      margin-bottom: 12px;
      padding: 8px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    button {
      background: #4caf50;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 10px 16px;
      cursor: pointer;
      font-weight: bold;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    button:disabled {
      opacity: 0.7;
      cursor: not-allowed;
    }

    button:hover:not(:disabled) {
      background: #45a049;
    }

    #progressBox {
      width: 100%;
      height: 20px;
      background: #eee;
      border-radius: 10px;
      overflow: hidden;
      margin-top: 10px;
      display: none;
    }

    #progressBar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #4caf50, #81c784);
    }

    #progressText {
      font-size: 12px;
      text-align: right;
      margin-top: 4px;
    }

    .file-list-section {
      max-width: 500px;
      margin: 20px auto;
    }

    .file-list {
      max-height: 300px;
      overflow-y: auto;
      list-style: none;
      padding: 0;
      margin-top: 10px;
    }

    .file-list li {
      background: #ffffff;
      padding: 12px 16px;
      margin-bottom: 10px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .download-btn {
      background: #4caf50;
      color: #fff;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 13px;
      text-decoration: none;
    }

    .download-btn:hover {
      background: #45a049;
    }

    /* Spinner inside refresh button */
    .spinner {
      width: 16px;
      height: 16px;
      border: 3px solid rgba(255,255,255,0.4);
      border-top: 3px solid #fff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      display: none;
    }

    .loading .spinner {
      display: inline-block;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>

<body>

<div class="upload-section">
  <h2>Upload File to Shared Storage</h2>
  <input type="file" id="fileInput">
  <button onclick="uploadFile()">Upload</button>

  <div id="progressBox">
    <div id="progressBar"></div>
  </div>
  <div id="progressText">0%</div>

  <p id="result"></p>
</div>

<div class="file-list-section">
  <h3>ðŸ“‚ Files in Shared Folder</h3>

  <!-- Refresh button with spinner -->
  <button id="refreshBtn" onclick="loadFiles()">
    <span class="spinner"></span>
    Refresh
  </button>

  <ul id="fileList" class="file-list"></ul>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwYrbDB3oaW_R6pJz1oFcrxt7RWS4w6bmYZ_wABQJv1-HEEMq7EMmlXmxfCvVe86wBm/exec";

function uploadFile() {
  const file = document.getElementById("fileInput").files[0];
  if (!file) return alert("Please select a file");

  const reader = new FileReader();
  const progressBox = document.getElementById("progressBox");
  const progressBar = document.getElementById("progressBar");
  const progressText = document.getElementById("progressText");
  const result = document.getElementById("result");

  progressBox.style.display = "block";
  progressBar.style.width = "0%";
  progressText.innerText = "0%";

  let percent = 0;
  const timer = setInterval(() => {
    if (percent < 90) {
      percent += 3;
      progressBar.style.width = percent + "%";
      progressText.innerText = percent + "%";
    }
  }, 200);

  reader.onload = () => {
    const base64 = reader.result.split(",")[1];
    const formData = new FormData();
    formData.append("file", base64);
    formData.append("name", file.name);
    formData.append("type", file.type);

    fetch(SCRIPT_URL, { method: "POST", body: formData })
      .then(res => res.json())
      .then(data => {
        clearInterval(timer);
        progressBar.style.width = "100%";
        progressText.innerText = "100%";

        if (data.status === "success") {
          result.innerHTML = `âœ… Uploaded: <strong>${data.fileName}</strong>`;
          loadFiles();
        }
      });
  };

  reader.readAsDataURL(file);
}

function loadFiles() {
  const list = document.getElementById("fileList");
  const refreshBtn = document.getElementById("refreshBtn");

  list.innerHTML = "";
  refreshBtn.disabled = true;
  refreshBtn.classList.add("loading");

  fetch(SCRIPT_URL)
    .then(res => res.json())
    .then(files => {
      files.forEach(file => {
        const li = document.createElement("li");
        li.innerHTML = `
          <span>${file.name}</span>
          <a href="${file.downloadUrl}" download class="download-btn">Download</a>
        `;
        list.appendChild(li);
      });
      refreshBtn.disabled = false;
      refreshBtn.classList.remove("loading");
    })
    .catch(() => {
      alert("Failed to load files");
      refreshBtn.disabled = false;
      refreshBtn.classList.remove("loading");
    });
}

loadFiles();
</script>

</body>
</html>
